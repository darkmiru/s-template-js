window.stpl_config={prefix:"s",useDataSet:false,propNames:{template:"template",dummyCheck:"dummy-tpl",fixed:"fixed",field:"field",type:"type",target:"target",subTemplate:"child-tpl",subCheck:"sub-tpl"},classNames:{child:"tplChild",parent:"tplParent"},designMode:true};if(window.stpl==undefined){var util={inArray:function(e,t){if(t.indexOf){return t.indexOf(e)}for(var n=0,r=t.length;n<r;n++){if(t[n]===e){return n}}return-1},trim:function(e){return e.replace(/^\s+|\s+$/g,"")},toCamel:function(e){return e.replace(/(\-[a-z])/g,function(e){return e.toUpperCase().replace("-","")})},toDash:function(e){return e.replace(/([A-Z])/g,function(e){return"-"+e.toLowerCase()})},hasClass:function(e,t){var n=e.className;if(n==undefined){return false}return util.inArray(t,n.split(" "))>-1},addClass:function(e,t){var n=e.className;if(n==undefined){e.className=t;return}var r=util.inArray(t,n.split(" "))>-1,i;if(!r){i=[n,t].join(" ");e.className=util.trim(i)}},removeClass:function(e,t){if(e==undefined||e==null){return}var n=e.className;if(n==undefined){return}var r=util.inArray(t,n.split(" "))>-1,i;if(r){i=n.replace(t,"");e.className=util.trim(i)}},makeStr:function(e,t){if(e==null||e==undefined){return e}var n=typeof e;if(n!="object"){return e}var r=t?t:"";t=(t?t:"")+"	";var i="{\n";for(var s in e){if(e[s]!=null&&e[s]!=undefined){i+=t+s+" : "+util.makeStr(e[s],t)+",\n"}}i+=r+"}";return i}};var processDefaultField=function(e,t,n,r,i,s){if(i===undefined||i===null){if(t.src!=undefined){t.src=r}else if(t.href!=undefined){t.href=r}else if(t.value!=undefined){t.value=r}else{t.innerHTML=r}}else{if(s=="attr"){t.setAttribute(i,r)}else{t[i]=r}}};function Template(e,t,n,r,i){this.name=e;this.elem=t;this.parent=n;this.fixed=r;this.onSetCB=processDefaultField;this.querySet=null;this.subCheck=i}Template.prototype.getInfo=function(){var e={name:this.name,fixed:this.fixed,subCheck:this.subCheck};e.fieldInfo=window.stpl.getFieldInfo(this.elem);return e};Template.prototype.getChildElemList=function(){var e=[];var t=window.stpl.config.classNames.child;for(var n=0;n<this.parent.children.length;n++){if(util.hasClass(this.parent.children[n],t)){e.push(this.parent.children[n])}}return e};Template.prototype.getChildCnt=function(){var e=this.getChildElemList();return e.length};Template.prototype.getChildElem=function(e){var t=this.getChildElemList();return t[e]};Template.prototype.processField=processDefaultField;Template.prototype.setFieldCB=function(e){this.onSetCB=e};Template.prototype.getFieldCB=function(){return this.onSetCB};Template.prototype.addData=function(e){if(this.fixed==true){return null}var t=this.elem.cloneNode(true);window.stpl.applyFieldData(t,e,this.onSetCB,this.querySet);this.parent.appendChild(t);return t};Template.prototype.insertData=function(e,t){if(this.fixed==true){return null}var n=this.elem.cloneNode(true);window.stpl.applyFieldData(n,e,this.onSetCB,this.querySet);if(typeof t=="number"){t=this.getChildElem(t)}this.parent.insertBefore(n,t);return n};Template.prototype.setData=function(e,t){var n=this.elem;if(this.fixed==false){n=this.getChildElem(t)}if(n!=null){window.stpl.applyFieldData(n,e,this.onSetCB,this.querySet)}return n},Template.prototype.getData=function(e){var t=this.elem;if(this.fixed==false){t=this.getChildElem(e)}return t.fieldData},Template.prototype.removeData=function(e){if(this.fixed==true){return null}if(typeof e=="number"){e=this.getChildElem(e)}this.parent.removeChild(e);return e};window.stpl=new function(){var t=this;var n={propNames:{},classNames:{}};if(window.stpl_config){n.prefix=window.stpl_config.prefix||"";n.useDataSet=window.stpl_config.useDataSet||false;if(window.stpl_config.propNames){n.propNames.template=window.stpl_config.propNames.template||"template";n.propNames.dummyCheck=window.stpl_config.propNames.dummyCheck||"dummy-tpl";n.propNames.fixed=window.stpl_config.propNames.fixed||"fixed";n.propNames.field=window.stpl_config.propNames.field||"field";n.propNames.type=window.stpl_config.propNames.type||"type";n.propNames.target=window.stpl_config.propNames.target||"target";n.propNames.subTemplate=window.stpl_config.propNames.subTemplate||"child-tpl";n.propNames.subCheck=window.stpl_config.propNames.subCheck||"sub-tpl"}if(window.stpl_config.classNames){n.classNames.child=window.stpl_config.classNames.child||"tplChild";n.classNames.parent=window.stpl_config.classNames.child||"tplParent"}n.designMode=window.stpl_config.designMode||true}t.config={prefix:n.prefix,useDataSet:n.useDataSet,propNames:{},dataNames:{},classNames:n.classNames,designMode:n.designMode};var r=t.config.useDataSet?"data-":"";var i=t.config.prefix.length>0?t.config.prefix+"-":"";for(var s in n.propNames){t.config.dataNames[s]=util.toCamel(i+n.propNames[s]);t.config.propNames[s]=r+i+n.propNames[s]}var o=window.location.search.split(/[?&]/);var u={};for(var a=0;a<o.length;a++){var f=o[a].split("=");u[f[0]]=f[1]}var l=t.config.designMode&&u["designMode"]=="true";var c=t.config.propNames;var h=t.config.dataNames;var p=t.config.classNames;var d=function(e,n){if(t.config.useDataSet){return e.dataset[h[n]]}else{return e.getAttribute(c[n])}};t.templateList={};t.initialize=function(){if(l){t.emptyTpl={addData:function(){return null},insertData:function(){return null},setData:function(){return null},getData:function(){return null},removeData:function(){return null},removeDataAll:function(){return null}}}else{var e=document.querySelectorAll("["+c.dummyCheck+"]");for(var n=0;n<e.length;n++){e[n].parentElement.removeChild(e[n])}}t.loadTemplate()};t.loadTemplate=function(e){var n=e;if(arguments.length==0){n=document}var r=n.querySelectorAll("["+c.template+"]");for(var i=0;i<r.length;i++){var s=r[i].querySelectorAll("["+c.template+"]");for(var o=0;o<s.length;o++){util.addClass(s[o].parentElement,p.parent);var u=d(s[o],"template");s[o].parentElement.setAttribute(c.subTemplate,u);s[o].setAttribute(c.subCheck,"true")}var a=d(r[i],"template");var f=d(r[i],"subCheck")=="true";var h=d(r[i],"fixed")=="true";if(t.templateList[a]){console.log("aleady existed template name :"+a);continue}r[i].removeAttribute(c.template);t.templateList[a]=new Template(a,r[i],r[i].parentElement,h,f);if(!l&&h==false&&r[i].parentElement){r[i].parentElement.removeChild(r[i])}}if(l){var v="";var m=true;for(var g in t.templateList){if(m==false){v+=",\n"}v+=util.makeStr(t.templateList[g].getInfo());m=false}console.log(v)}};t.getFieldInfo=function(e){var t={};var n=e.querySelectorAll("["+c.field+"]");for(var r=0;r<n.length;r++){var i=d(n[r],"field");var s=d(n[r],"type");var o=d(n[r],"target");t[i]={tagName:n[r].tagName,type:s,target:o}}return t};t.applyFieldData=function(e,t,n,r){util.addClass(e,p.child);var i=e.querySelectorAll("["+c.field+"]");for(var s=0;s<i.length;s++){var o=d(i[s],"field");var u=d(i[s],"type");var a=d(i[s],"target");if(t[o]!=undefined){n(e,i[s],o,t[o],a,u)}}if(r){for(var o in r){var i=e.querySelector(r[o]);if(t[o]!=undefined){n(e,i[s],o,t[o])}}}if(e.fieldData===undefined){e.fieldData=t}else{for(var f in t){e.fieldData[f]=t[f]}}};this.addData=function(e,n,r){var i=t.getTemplate(e,r);return i.addData(n)};this.insertData=function(e,n,r,i){var s=t.getTemplate(e,i);return s.insertData(n,r)};this.setData=function(e,n,r,i){var s=t.getTemplate(e,i);return s.setData(n,r)},this.getData=function(e,n,r){var i=t.getTemplate(e,r);return i.getData(n)},this.removeData=function(e,n,r){var i=t.getTemplate(e,r);return i.removeData(n)};this.removeDataAll=function(e,n){var r=t.getTemplate(e,n);if(r.fixed==true){return}var i=r.getChildElemList();for(var s=i.length-1;s>=0;s--){r.parent.removeChild(i[s])}};this.getTemplate=function(e,n){if(l){return t.emptyTpl}var r=this.templateList[e];if(r==undefined){throw"template is not exist. - "+e}if(r.subCheck){if(n){var i=null;if(n.getAttribute(c.subTemplate)==e){i=n}else{i=n.querySelector("["+c.subTemplate+"="+e+"]")}if(i!=null){r.parent=i}}else{return null}}return r};this.setTemplate=function(e,n){t.templateList[e]=n};this.removeTemplate=function(e){var n=this.templateList[e];delete t.templateList[e];return n};this.removeAllTemplate=function(){t.templateList.length=0}};document.addEventListener("DOMContentLoaded",function(e){stpl.initialize()},false)}